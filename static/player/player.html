<!--TODO: Card flip-->
<!--TODO: Ressourcen-->
<!--TODO: enable/disable cards based on available resources-->
<!--TODO: Fullscreen (at login)-->

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Design</title>
    <link rel="stylesheet" type="text/css" href="/player/base.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
<section id="information">
    <article id="infotext">
        <img src="">
        <span></span>
        <span></span>
    </article>
    <article id="timer">30</article>
</section>
<div id="cards">
    <div id="cards_inner">
        <!--<div class="card_wrap">-->
            <!--<div class="card">-->
                <!--<header>-->
                    <!--<img class="_icon" src="{base64url}">-->
                    <!--<span class="_resourceCount">3</span>-->
                <!--</header>-->
                <!--<section>Verteidigung</section>-->
                <!--<footer><span>Turm</span><span>&nbsp;</span><span>+5</span></footer>-->
            <!--</div>-->
        <!--</div>-->
    </div>
</div>
<!--<div id="stats">-->
    <!--<article id="statistics">-->
        <!--<section class="stats opponent">-->
            <!--<h2>Gegner</h2>-->
            <!--<p>Turm: <span id="tower_opponent">52</span></p>-->
            <!--<p>Zaun: <span id="fence_opponent">12</span></p>-->
        <!--</section>-->
        <!--<section class="stats own">-->
            <!--<h2>Ich</h2>-->
            <!--<p>Turm: <span id="tower_own">75</span></p>-->
            <!--<p>Zaun: <span id="fence_own">34</span></p>-->
        <!--</section>-->
    <!--</article>-->
<!--</div>-->
<article id="resources">
    <h1>Ressourcen</h1>
    <div id="resources_inner">
        <section>
            <img class="icon_1" id="icon_1" src="">
            Steine: <span id="stones">7</span>
        </section>
        <section>
            <img class="icon_1" id="icon_2" src="">
            Schwerter: <span id="swords">12</span>
        </section>
    </div>
</article>
<button id="button">Fullscreen</button>
</body>
</html>
<script>
    (function() {
        const socket = io();
        socket.emit("clientConnect", {});

        socket.on("join", iNumber => {
            const imgStatus = document.getElementById("infotext").getElementsByTagName("img")[0];
            const txtPlayer = document.getElementById("infotext").getElementsByTagName("span")[0];
            if (iNumber === 1) {
                imgStatus.src = "/images/basic/wifi.png";
                txtPlayer.innerText = "Spieler 1";
                document.getElementById("information").classList.add("joined");
            } else if (iNumber === 2) {
                imgStatus.src = "/images/basic/wifi.png";
                txtPlayer.innerText = "Spieler 2";
                document.getElementById("information").classList.add("joined");
            } else {
                imgStatus.src = "/images/basic/no-wifi.png";
            }
        });

        socket.on("leave", () => {
            document.getElementById("infotext").getElementsByTagName("img")[0].src = "/images/basic/no-wifi.png";
            document.getElementById("infotext").getElementsByTagName("span")[0].innerText = "";
            document.getElementById("information").classList.remove("joined");
        });

        socket.on("start", () => {
            const txtPlayer = document.getElementById("infotext").getElementsByTagName("span")[1].innerText = "Spiel gestartet";
        });

    	const oCardsWrap = document.getElementById("cards_inner");

    	const sImg = "";

    	const aCards = [
			{
				icon: sImg,
				resourceCount: 4,
				category: "Verteidigung",
                target: "Turm",
                value: "+5",
                class: "defend"
			}, {
				icon: sImg,
				resourceCount: 4,
				category: "Verteidigung",
				target: "Turm",
				value: "+5",
				class: "defend"
			}, {
				icon: sImg,
				resourceCount: 4,
				category: "Verteidigung",
				target: "Turm",
				value: "+5",
				class: "defend"
			}, {
				icon: sImg,
				resourceCount: 4,
				category: "Verteidigung",
				target: "Turm",
				value: "+5",
				class: "attack"
			}, {
				icon: sImg,
				resourceCount: 4,
				category: "Verteidigung",
				target: "Turm",
				value: "+5",
				class: "attack"
			}, {
				icon: sImg,
				resourceCount: 4,
				category: "Verteidigung",
				target: "Turm",
				value: "+5",
				class: "attack"
			}, {
				icon: sImg,
				resourceCount: 4,
				category: "Verteidigung",
				target: "Turm",
				value: "+5",
				class: "attack"
			}, {
				icon: sImg,
				resourceCount: 4,
				category: "Verteidigung",
				target: "Turm",
				value: "+5",
				class: "attack"
			}
        ];

		/**
         * Creates the header of a card, containing the type image and resource count
		 * @param oCard
		 * @returns {HTMLElement}
		 */
		const createHeader = oCard => {
			const oIcon = document.createElement("img");
			oIcon.setAttribute("class", "_icon");
			oIcon.setAttribute("src", oCard.icon);

			const oResourceCount = document.createElement("span");
			oResourceCount.setAttribute("class", "_resourceCount");
			oResourceCount.innerText = oCard.resourceCount.toString();

			const oHeader = document.createElement("header");
			oHeader.appendChild(oIcon);
			oHeader.appendChild(oResourceCount);
			return oHeader;
        };

		/**
         * Creates the footer of the card, containing the target and the value
		 * @param oCard
		 * @returns {HTMLElement}
		 */
		const createFooter = oCard => {
			const oTarget = document.createElement("span");
			oTarget.innerText = oCard.target;

			const oSpace = document.createElement("span");
			oSpace.innerText = " ";

			const oValue = document.createElement("span");
			oValue.innerText = oCard.value;

			const oFooter = document.createElement("footer");
			oFooter.appendChild(oTarget);
			oFooter.appendChild(oSpace);
			oFooter.appendChild(oValue);
			return oFooter;
        };

		/**
         * Renders a card with the given information in oCard
		 * @param oCard
		 */
		const fnRenderCard = oCard => {
			const oNewCard = document.createElement("div");
			oNewCard.setAttribute("class", `card ${oCard.class}`);
			oNewCard.appendChild(createHeader(oCard));

			const oCategory = document.createElement("section");
			oCategory.innerHTML = oCard.category;
			oNewCard.appendChild(oCategory);

			oNewCard.appendChild(createFooter(oCard));

			const oCardWrap = document.createElement("div");
			oCardWrap.setAttribute("class", "card_wrap");
			oCardWrap.appendChild(oNewCard);
			oCardWrap.onclick = function() {
			    socket.emit('card', "001");
            };
			oCardsWrap.appendChild(oCardWrap);
        };

    	aCards.forEach(fnRenderCard);


    	// TEMPORARY
		document.getElementById("icon_1").setAttribute("src", sImg);
		document.getElementById("icon_2").setAttribute("src", sImg);

		const oTimer = document.getElementById("timer");
		nSeconds = 5;
		oTimer.innerText = nSeconds;
		const timer = window.setInterval(() => {
			if (nSeconds > 0) {
				nSeconds--;
				oTimer.innerText = nSeconds;
			} else {
				window.clearInterval(timer);
            }
        }, 1000);

		function enterFullscreen(element) {
			if(element.requestFullscreen) {
				element.requestFullscreen();
			} else if(element.mozRequestFullScreen) {
				element.mozRequestFullScreen();
			} else if(element.msRequestFullscreen) {
				element.msRequestFullscreen();
			} else if(element.webkitRequestFullscreen) {
				element.webkitRequestFullscreen();
			}
		}

		document.getElementById("button").onclick = () => enterFullscreen(document.documentElement);
	})();
</script>